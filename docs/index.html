<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Agent-side functions in Puppet 6. Wait, that's a thing?</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/>

  

  <link rel="stylesheet" type="text/css" href="css/highlight/default.css"  />
  <link rel="stylesheet" type="text/css" href="css/mermaid-6.0.0.css" />
  <link rel="stylesheet" type="text/css" href="css/font-awesome-5.6.1/css/all.min.css">
  <link rel="stylesheet" type="text/css" href="css/introjs-2.5.local.css">
  <link rel="stylesheet" type="text/css" href="css/jquery-ui-1.12.1.css">
  <link rel="stylesheet" type="text/css" href="css/showoff.css?v=0.20.0" />
  <link rel="stylesheet" type="text/css" href="css/zoomline-0.0.1.css">

  <script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
  <script type="text/javascript" src="js/jquery-ui-1.12.1.js"></script>

  <script type="text/javascript" src="js/jquery.cycle.all-2.8.0.js"></script>
  <script type="text/javascript" src="js/jquery.batchImageLoad-1.0.0.js"></script>
  <script type="text/javascript" src="js/jquery.parsequery.min-6a20f83.js"></script>
  <script type="text/javascript" src="js/jquery.doubletap-4ff02c5.js"></script>
  <script type="text/javascript" src="js/highlight.pack-9.2.0.js"></script>
  <script type="text/javascript" src="js/highlightjs-line-numbers.min.js"></script>
  <script type="text/javascript" src="js/jTypeWriter-1.1.js"></script>
  <script type="text/javascript" src="js/bigtext-0.1.8.js"></script>
  <script type="text/javascript" src="js/zoomline-0.0.1.js"></script>
  <script type="text/javascript" src="js/simpleStrings-0.0.1.js"></script>
  <script type="text/javascript" src="js/mermaid-6.0.0-min.js"></script>

  <!-- waiting on https://github.com/usablica/intro.js/pull/727 -->
  <script type="text/javascript" src="js/intro-2.5.local.js"></script>

  <script type="text/javascript" src="js/coffee-script-1.1.3-pre.js"></script>

  <script type="text/javascript" src="js/annotations.js?v=0.20.0"></script>
  <script type="text/javascript" src="js/showoff.js?v=0.20.0"></script>

  
    <link rel="stylesheet" type="text/css" href="file/styles.css" />
  

  
    <script type="text/javascript" src="file/scripts.js"></script>
  

  <script type="text/javascript">
    $(function(){
      setupPreso(false);
    });

    editUrl     = "";
    interactive = false;
    master      = false;
    presenter   = false;

    keymap               = {
  "d": "DEBUG",
  "space": "NEXT",
  "down": "NEXT",
  "right": "NEXT",
  "pagedown": "NEXT",
  "up": "PREV",
  "left": "PREV",
  "pageup": "PREV",
  "SPACE": "NEXTSEC",
  "DOWN": "NEXTSEC",
  "RIGHT": "NEXTSEC",
  "PAGEDOWN": "NEXTSEC",
  "UP": "PREVSEC",
  "LEFT": "PREVSEC",
  "PAGEUP": "PREVSEC",
  "R": "RELOAD",
  "r": "REFRESH",
  "c": "CONTENTS",
  "t": "CONTENTS",
  "h": "HELP",
  "/": "HELP",
  "?": "HELP",
  "b": "BLANK",
  ".": "BLANK",
  "F": "FOOTER",
  "f": "FOLLOW",
  "n": "NOTES",
  "esc": "CLEAR",
  "p": "PAUSE",
  "P": "PRESHOW",
  "x": "EXECUTE",
  "f5": "EXECUTE"
};
    keycode_dictionary   = {
  "0": "\\",
  "8": "backspace",
  "9": "tab",
  "12": "num",
  "13": "enter",
  "16": "shift",
  "17": "ctrl",
  "18": "alt",
  "19": "pause",
  "20": "caps",
  "27": "esc",
  "32": "space",
  "33": "pageup",
  "34": "pagedown",
  "35": "end",
  "36": "home",
  "37": "left",
  "38": "up",
  "39": "right",
  "40": "down",
  "44": "print",
  "45": "insert",
  "46": "delete",
  "48": "0",
  "49": "1",
  "50": "2",
  "51": "3",
  "52": "4",
  "53": "5",
  "54": "6",
  "55": "7",
  "56": "8",
  "57": "9",
  "59": ";",
  "61": "=",
  "65": "a",
  "66": "b",
  "67": "c",
  "68": "d",
  "69": "e",
  "70": "f",
  "71": "g",
  "72": "h",
  "73": "i",
  "74": "j",
  "75": "k",
  "76": "l",
  "77": "m",
  "78": "n",
  "79": "o",
  "80": "p",
  "81": "q",
  "82": "r",
  "83": "s",
  "84": "t",
  "85": "u",
  "86": "v",
  "87": "w",
  "88": "x",
  "89": "y",
  "90": "z",
  "91": "cmd",
  "92": "cmd",
  "93": "cmd",
  "96": "num_0",
  "97": "num_1",
  "98": "num_2",
  "99": "num_3",
  "100": "num_4",
  "101": "num_5",
  "102": "num_6",
  "103": "num_7",
  "104": "num_8",
  "105": "num_9",
  "106": "num_multiply",
  "107": "num_add",
  "108": "num_enter",
  "109": "num_subtract",
  "110": "num_decimal",
  "111": "num_divide",
  "112": "f1",
  "113": "f2",
  "114": "f3",
  "115": "f4",
  "116": "f5",
  "117": "f6",
  "118": "f7",
  "119": "f8",
  "120": "f9",
  "121": "f10",
  "122": "f11",
  "123": "f12",
  "124": "print",
  "144": "num",
  "145": "scroll",
  "173": "-",
  "186": ";",
  "187": "=",
  "188": ",",
  "189": "-",
  "190": ".",
  "191": "/",
  "192": "`",
  "219": "[",
  "220": "\\",
  "221": "]",
  "222": "'",
  "223": "`",
  "224": "cmd",
  "225": "alt",
  "57392": "ctrl",
  "63289": "num"
};
    keycode_shifted_keys = {
  "0": ")",
  "1": "!",
  "2": "@",
  "3": "#",
  "4": "$",
  "5": "%",
  "6": "^",
  "7": "&",
  "8": "*",
  "9": "(",
  "/": "?",
  ".": ">",
  ",": "<",
  "'": "\"",
  ";": ":",
  "[": "{",
  "]": "}",
  "\\": "|",
  "`": "~",
  "=": "+",
  "-": "_",
  "space": "SPACE",
  "down": "DOWN",
  "right": "RIGHT",
  "pagedown": "PAGEDOWN",
  "up": "UP",
  "left": "LEFT",
  "pageup": "PAGEUP"
};
    user_translations    = {
};

    I18n = new translation({"name":"Showoff Presentation","menu":{"title":"Showoff Menu","table_of_contents":"Table of Contents","downloads":"Downloads","feedback":{"label":"Send Feedback","description":"This slide is...","worst":"Terrible","best":"Awesome","why":"Why...?","send":"Send"},"pace":{"label":"The presenter should...","slower":"Slow Down","faster":"Speed Up"},"question":{"label":"Ask a Question","placeholder":"Ask a question..."},"edit":"Edit Current Slide","clear_annotations":"Clear Annotations","language":"Content Language","close":"Close","help":"Press <code>?</code> for help.","anonymous":"All features are anonymous.","sending":"Sending..."},"navigation":{"next":"Next","previous":"Previous","sync":"Sync Presentation"},"loading":"loading presentation...","activity_complete":"Activity complete","follow":{"label":"Follow Mode:"},"refresh":"Are you sure you want to refresh the slide content?\n\n(Use `RELOAD` to fully reload the entire UI)","reload":"Are you sure you want to reload Showoff?","preshow":{"prompt":"Minutes from now to start?","resume":"Resuming in:"},"tour":{"show":"See the Tour","reset":"Reset Hints","welcome":"<h3>Welcome to Showoff</h3>Let me show you around. After you finish this tour, it won't show again.","displayview":"Start by clicking this button to open the Display Window; then drag it onto the projector.","annotations":"Draw on your slides everywhere the presentation is displayed.","timer":"Set a countdown timer to help you stay on pace.","pace":"Audience members can use this to tell you if you're moving too quickly. Try to keep the indicator centered.","questions":"Questions asked by audience members are displayed here. You'll also see a count indicator on the Display Window when you have questions to answer.","notes":"Configure the notes display by zooming text, resizing the pane, or even popping it out into a new window.","slidesource":"The name of the slide is displayed here.","settings":"Would you like a different presenter layout? Choose that and other settings here.","edit":"This button will open your web-based editor--usually something like GitHub.","report":"Don't forget to report issues when you see them.","activity":{"count":"This will count down as audience members mark their activity complete. Their presentations will pause until completed.","complete":"Check this box when you're ready to move on. The presentation will pause while you're working."},"form":{"responses":"As questions are answered, they'll show up as a bar chart with the number of answers to each question on the right.","display":"Press this button to present a snapshot of the live responses on slide.","save":"Press this button to save your responses. The presentation will pause while answering."},"menu":{"start":"Click here to open the menu.","navigation":"Quickly navigate to any slide.","download":"Download presentation support files.","pace":"Provide pace feedback.","questions":"Ask live questions of the presenter.","feedback":"Provide suggestions for improving the content."}},"downloads":{"title":"File Downloads"},"help":{"title":"Help","next":"Move to the next slide.","prev":"Move to the previous slide.","nextsec":"Move to the next section.","prevsec":"Move to the previous section.","contents":"Show the table of contents menu.","follow":"Toggle follow mode.","help":"Show this help dialog.","refresh":"Refresh slide content.","reload":"Completely reload Showoff.","blank":"Blank the screen.","footer":"Toggle the display footer.","notes":"Toggle notes display.","clear":"Clear code execution results.","pause":"Pause the presentation.","preshow":"Display slideshow of <tt>preshow</tt> images on a timer.","execute":"Execute the first visible code block.","debug":"Show debugging information.","close":"Close"},"stats":{"title":"Viewing Statistics","stray":"of your audience is not viewing the same slide you are.","idle":"of your audience is idle.","current":"Slides currently being viewed","elapsed":"Elapsed time spent on each slide","nodata":"No data to display.","allcurrent":"All audience members are viewing the presenter's slide."},"forms":{"display":"Display Results","save":"Save"},"presenter":{"topbar":{"annotations":"Annotations","edit":"Edit Slide","report":"Report Issue With Slide","stats":"Viewing Statistics","downloads":"Downloads","display":"Display Window","print":"Print Slides","settings":"Settings","newpage":"Open in a new page...","tooltip":{"annotations":"Enable the annotations subsystem.","edit":"Edit current slide in new window.","report":"Report an issue with the current slide.","stats":"See the slides your audience is interacting with.","downloads":"Open the file downloads in a menu or new page.","display":"Enable the Display Window; you should put this on the projector.","print":"Print slides using a new window.","settings":"Open the Settings dialog."}},"preview":{"next":"Next","previous":"Previous"},"mobile":{"update":"Update"},"notes":{"label":"Showoff Notes","personal":"Personal Notes"},"timer":{"label":"Timer:","start":"Start","pause":"Pause","resume":"Resume","cancel":"Cancel","unit":"minutes"},"pace":{"faster":"Speed Up!","slower":"Slow Down!"},"questions":"Audience Questions","annotation":{"tools":"Tools","lines":"Lines","shapes":"Shapes"},"status":{"label":"Slides:"},"settings":{"label":"Settings","close":"Close","follower":{"label":"Update Follower","tooltip":"Send slide change notifications.","description":"When this is enabled, the Showoff server will track your slide changes. Disable it to observe the presentation without inadvertently causing slide changes."},"remote":{"label":"Enable Remote","tooltip":"Enables tracking of other presenters.","description":"When this is enabled, you can load the presenter in another browser (typically on your mobile phone) to control the presentation."},"layout":{"label":"Layout","default":"Default Layout","thumbs":"Display thumbnail previews of the next and previous slides.","beside":"Display the next slide as a large preview in the main presenter view.","floating":"Open the next slide as a floating window.","confirmation":"Browser security requires confirmation before opening a new window.","open":"Open Window","cancel":"cancel","reset":{"label":"Clear Showoff settings.","tooltip":"Reset Showoff UI settings to default values."}},"language":{"label":"Content Language","tooltip":"Select from available translations, or autoselect based on your browser settings.","description":"This presentation is available in different languages. Choose the language you would like to view or leave it at <tt>automatic</tt> to use your browser settings."}},"print":{"label":"Choose type of printed notes","description":"Select the content you'd like to show under the slides.","none":"Don't include notes","notes":"Presenter Notes","handouts":"Audience Handouts"}},"language":{"auto":"Automatic","disable":"Disable Translations"},"error":{"file_not_found":"File Not Found!"}});

  </script>

</head>

<body>
<div id="questionsIndicator"></div>

<i id="hamburger" class="fa fa-bars fa-2x"></i>
<div id="sidebarWrapper">
    <div id="navigationHover"></div>
    <div id="feedbackSidebar" class="sideMenu">
    <img id="disconnected" src="css/disconnected.png">
    <h3>Showoff Menu</h3>
    <div id="navToggle" class="buttonWrapper"><i class=" fa fa-bookmark"></i> Table of Contents</div>
    <div id="navigation" class="submenu"></div>
    
    <hr>

    

    

    <div id="closeMenu" class="buttonWrapper"><i class="fa fa-close"></i> Close</div>
    <hr>

    <small>
        <p>Press <code>?</code> for help.</p>
        <p>All features are anonymous.</p>
    </small>
    </div>
    <div id="sidebarExit"></div>
</div>
<div id="help-modal" title="Help">
  <div id="help">
    <div>
      <span class="description">Move to the next slide.</span>
      <span class="action">NEXT</span>
      <span class="hotkeys"><span class="key">space</span><span class="key">down</span><span class="key">right</span><span class="key">pagedown</span></span>
    </div>
    <div>
      <span class="description">Move to the previous slide.</span>
      <span class="action">PREV</span>
      <span class="hotkeys"><span class="key">up</span><span class="key">left</span><span class="key">pageup</span></span>
    </div>
    <div>
      <span class="description">Move to the next section.</span>
      <span class="action">NEXTSEC</span>
      <span class="hotkeys"><span class="key">SPACE</span><span class="key">DOWN</span><span class="key">RIGHT</span><span class="key">PAGEDOWN</span></span>
    </div>
    <div>
      <span class="description">Move to the previous section.</span>
      <span class="action">PREVSEC</span>
      <span class="hotkeys"><span class="key">UP</span><span class="key">LEFT</span><span class="key">PAGEUP</span></span>
    </div>
    <div>
      <span class="description">Show the table of contents menu.</span>
      <span class="action">CONTENTS</span>
      <span class="hotkeys"><span class="key">c</span><span class="key">t</span></span>
    </div>
    <div>
      <span class="description">Toggle follow mode.</span>
      <span class="action">FOLLOW</span>
      <span class="hotkeys"><span class="key">f</span></span>
    </div>
    <div>
      <span class="description">Show this help dialog.</span>
      <span class="action">HELP</span>
      <span class="hotkeys"><span class="key">h</span><span class="key">/</span><span class="key">?</span></span>
    </div>

    <hr />

    <div>
      <span class="description">Refresh slide content.</span>
      <span class="action">REFRESH</span>
      <span class="hotkeys"><span class="key">r</span></span>
    </div>
    <div>
      <span class="description">Completely reload Showoff.</span>
      <span class="action">RELOAD</span>
      <span class="hotkeys"><span class="key">R</span></span>
    </div>
    <div>
      <span class="description">Blank the screen.</span>
      <span class="action">BLANK</span>
      <span class="hotkeys"><span class="key">b</span><span class="key">.</span></span>
    </div>
    <div>
      <span class="description">Toggle the display footer.</span>
      <span class="action">FOOTER</span>
      <span class="hotkeys"><span class="key">F</span></span>
    </div>
    <div>
      <span class="description">Toggle notes display.</span>
      <span class="action">NOTES</span>
      <span class="hotkeys"><span class="key">n</span></span>
    </div>
    <div>
      <span class="description">Clear code execution results.</span>
      <span class="action">CLEAR</span>
      <span class="hotkeys"><span class="key">esc</span></span>
    </div>
    <div>
      <span class="description">Pause the presentation.</span>
      <span class="action">PAUSE</span>
      <span class="hotkeys"><span class="key">p</span></span>
    </div>
    <div>
      <span class="description">Display slideshow of <tt>preshow</tt> images on a timer.</span>
      <span class="action">PRESHOW</span>
      <span class="hotkeys"><span class="key">P</span></span>
    </div>
    <div>
      <span class="description">Execute the first visible code block.</span>
      <span class="action">EXECUTE</span>
      <span class="hotkeys"><span class="key">x</span><span class="key">f5</span></span>
    </div>

    <hr />

    <div>
      <span class="description">Show debugging information.</span>
      <span class="action">DEBUG</span>
      <span class="hotkeys"><span class="key">d</span></span>
    </div>
  </div>
</div>

<div id="preso"><center>loading presentation...</center></div>
<a id="synchronize"><i class="fa fa-link" aria-hidden="true" href="#"></i> Sync Presentation</a>
<div id="notes"></div>

<footer id="footer">
  <span id="followLabel" class="container">Follow Mode: <i id="followMode" class="fa fa-ban" aria-hidden="true"></i></span>
  <span id="slideInfo" class="container"></span>
  <span id="debugInfo" class="container"></span>
  <span id="notesInfo" class="container"></span>
  <span id="slideFilename" class="container"></span>
  <img id="disconnected" src="css/disconnected.png" />
</footer>

<div id="slides" class="offscreen" style="display:none;">
<div data-section="slides" data-title="title" id="slides_title" class="slide center" data-transition="none">
<div class="content center" ref="slides/title">
<h1>Agent Side functions in Puppet 6</h1>

<h2><i class="fa fa-surprise] Wait, that's a thing? [fa-grin-stars"></i></h2>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="introduction" id="slides_introduction" class="slide r nofooter" data-transition="none">
<div class="content r nofooter" ref="slides/introduction">
<h1>New talk, who dis?</h1>

<p><img src="./file//_images/square.jpeg" alt="profile"></p>

<ul>
<li>Ben Ford</li>
<li>Developer Advocate @ Puppet</li>
<li>@binford2k:
<a href="https://www.twitter.com/binford2k" target="_blank"> [fab-twitter] </a>
<a href="https://www.github.com/binford2k" target="_blank"> [fab-github] </a>
<a href="https://puppetcommunity.slack.com/team/U11HA7VJ7" target="_blank"> [fab-slack] </a>
</li>
</ul>


</div>
<div class="notes-section notes">

<ul>
<li>Hi, I'm Ben, aka binford2k on the interwebs.</li>
<li>I push the bits and talk to the peoples at Puppet and in our community.</li>
<li>If you've been around long enough, then I've probably told you to <em>just fucking
upgrade already</em> at some point, so in keeping with tradition, I'll be doing that
again today.</li>
<li>This time I'll do it by showing you a pretty rad new feature in Puppet 6 though.</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="overview" id="slides_overview" class="slide center" data-transition="none">
<div class="content center" ref="slides/overview">
<h1>Deferred Functions</h1>

<h2>people have been asking for them since...</h2>

<h3>...well, forever</h3>

<ul>
<li>Bits of code that can run <strong><em>agent side</em></strong> during catalog enforcement</li>
<li>Told in context of porting my own secret management module</li>
<li>Caveats, cautions, and guardrails</li>
</ul>

<p class="callout cheers">You didn't think I was going to tell you how to write
Puppet code like a fancy shell script, did you?</p>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="puppetconf_2015" id="slides_puppetconf_2015" class="slide center" data-transition="none">
<div class="content center" ref="slides/puppetconf_2015">
<h1>Let's set the stage</h1>

<p><img src="./file//_images/puppetconf-2014.jpg" alt="puppetconf"></p>


</div>
<div class="notes-section notes">

<ul>
<li>Down in the bottom of that weird hotel, talking to people</li>
<li>I noticed a recurring theme throughout the whole event</li>
<li>Secrets, secrets, SECRETS!</li>
<li>Everyone wanted to talk secret management</li>
<li>Vault was like negative eight months old at this point</li>
</ul>

<p>But with good reason. See, let's dig into a sneak peek into the innards of the Puppet Catalog.</p>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="secrets" id="slides_secrets" class="slide center" data-transition="none">
<div class="content center" ref="slides/secrets">
<h1>Artist's Rendition of Puppet Catalogs</h1>

<p><img src="./file//_images/secrets_everywhere.jpg" alt="secrets everywhere"></p>


</div>
<div class="notes-section notes">

<ul>
<li>Let's level set first, because I don't want to scare you</li>
<li>Once Puppet's completed the initial certificate handshake, everything is SSL</li>
<li>So it's not like we're squirting secrets around Zune style</li>
<li>But the catalog itself has plain text secrets in it.</li>
<li>And there are reports, and diffs, and cached state files too.</li>
<li>The files are all protected by <code>root</code> filesystem permissions.</li>
<li>But that's a lot of eggs to put in one basket.</li>
<li>If an attacker gets ahold of the catalog, they've got the keys to everything.</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="example_plain" id="slides_example_plain" class="slide" data-transition="none">
<div class="content " ref="slides/example_plain">
<h1>Example Secret</h1>

<h2>Plain text in the catalog</h2>

<pre class="highlight"><code class="language-puppet">file { '/etc/payroll/credentials.conf':
  ensure  =&gt; file,
  owner   =&gt; 'root',
  group   =&gt; 'root',
  mode    =&gt; '0600',
  content =&gt; 'some fake secret for cfgmgmtcamp',
}</code></pre>



<pre class="highlight"><code class="language-shell execute code_wrap">bolt command run "cat /etc/payroll/credentials.conf"  --node agent</code></pre>



<pre class="highlight"><code class="language-shell execute code_wrap">bolt command run "jq '.resources[] | select(.type == \"File\" and .title == \"/etc/payroll/credentials.conf\").parameters' /opt/puppetlabs/puppet/cache/client_data/catalog/agent.json" --node agent</code></pre>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="argument" id="slides_argument" class="slide" data-transition="none">
<div class="content " ref="slides/argument">
<h1>Friendly disagreement</h1>

<h2>Is Puppet's CA sufficient for secret management?</h2>

<p><img src="./file//_images/duty_calls.jpg" alt="Duty Calls -- someone is wrong"></p>


</div>
<div class="notes-section notes">

<ul>
<li>No surprise, in that loaded environment, I ended up debating secrets</li>
<li>The question was whether Puppet's existing CA and distribution mechanisms were
more-or-less sufficient for basic secret management.</li>
<li>I thought that the agent could encrypt text using its certificate and the agent
could then decrypt it using its own certificate</li>
<li>It would use the built in Puppet CA and meant that each agent could only decrypt
its own secrets</li>
<li>Sure there were challenges, but I knew it would work conceptually.</li>
<li>But as often happens with strongly opinionated folk, neither of us changed position much.</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="just_build_it" id="slides_just_build_it" class="slide" data-transition="none">
<div class="content " ref="slides/just_build_it">
<h1>So I'll just build it</h1>

<h2>We'll see if it works</h2>

<p><img src="./file//_images/ugh.jpg" alt="ugh, fine. I'll do it myself"></p>


</div>
<div class="notes-section notes">

<ul>
<li>So some time afterwards, I just built the thing

<ul>
<li>as one does</li>
</ul>
</li>
<li>a secret management framework for Puppet with no external requirements</li>
<li>In a way, it was inspired by that friendly disagreement</li>
<li>But did it really work?

<ul>
<li>Sure, it did the things -- thousands of people use it today</li>
<li>But there were architectural challenges</li>
<li>Let's explore those for a moment</li>
</ul>
</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="architecture" id="slides_architecture1" class="slide" data-transition="none">
<div class="content " ref="slides/architecture:1">
<h1>Master-Agent Architecture</h1>

<p><img src="./file//_images/DataFlowNodes.png" alt="Puppet architecture"></p>


</div>
<div class="notes-section notes">

<ul>
<li>If you've taken one of my classes, you've probably seen this image enough to
be sick of it.</li>
<li>The important part about this is that all processing happens on the master
during compilation.</li>
<li>The catalog that gets sent back to the agent is just json... [switch]</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="architecture" id="slides_architecture2" class="slide" data-transition="none">
<div class="content " ref="slides/architecture:2">
<h1>Master-Agent Architecture</h1>

<p><img src="./file//_images/DataFlowNodesJson.png" alt="Puppet architecture"></p>


</div>
<div class="notes-section notes">

<ul>
<li>And that's important because it's just data.</li>
<li>It's nothing more that a list of resources and their properties.</li>
<li>There's nothing executable in there.

<ul>
<li>with the obvious exception of embedded <code>exec</code> commands and the like</li>
</ul>
</li>
<li>And this means that the agent doesn't <strong><em>run your code</em></strong>.

<ul>
<li>All the Puppet code you've ever written has been run on the master.</li>
</ul>
</li>
<li>Instead, the agent looks at this json state description and decides what tools to use to
enforce that state.</li>
<li>This is how we make it declarative and immutable.</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="example_resource" id="slides_example_resource" class="slide" data-transition="none">
<div class="content " ref="slides/example_resource">
<h1>Example Catalog Resource</h1>

<pre class="highlight"><code class="language-json">{
  "type": "File",
  "title": "/etc/puppetlabs/mcollective/server.cfg",
[...]
  "parameters": {
    "content": "plugin.activemq.pool.1.password = TekjzYZubjJG3WgSOkq4...",
    "owner": "root",
    "group": "wheel",
    "mode": "0660",
    "notify": "Service[mcollective]",
    "backup": false
  },
  "sensitive_parameters": ["content"]
},</code></pre>



<ul>
<li>For each resource

<ul>
<li>Puppet chooses the best provider for that type</li>
<li>Invokes the provider with the data you see here</li>
</ul>
</li>
</ul>

<p class="callout warning">Which means that <em>only a provider</em> can run code to decrypt the ciphertext</p>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="provider_per" id="slides_provider_per" class="slide animate" data-transition="none">
<div class="content animate" ref="slides/provider_per">
<h1>Which means...</h1>

<h2>At least one provider per type I wanted to support.</h2>

<p><img src="./file//_images/minions.jpg" class=" animate" alt=""></p>


</div>
<div class="notes-section notes">

<ul>
<li>There were some 50 type in core Puppet at the time</li>
<li>And that's not even including modules, like concat or mysql</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="node_encrypt" id="slides_node_encrypt" class="slide" data-transition="none">
<div class="content " ref="slides/node_encrypt">
<h1>Encrypting a file in the catalog</h1>

<h2>How it works (3.x - 5.x)</h2>

<p>A function run on the master during compilation:</p>

<pre class="highlight"><code class="language-ruby">Puppet::Parser::Functions::newfunction(:node_encrypt, [...]) do |args|
  content  = args.first
  certname = self.lookupvar('clientcert')
  Puppet_X::Binford2k::NodeEncrypt.encrypt(content, certname)
end</code></pre>

<p>And a provider run on the agent during enforcement:</p>

<pre class="highlight"><code class="language-ruby">Puppet::Type.type(:node_encrypted_file).provide(:ruby) do
  desc 'Ruby provider for the node_encrypted_file type'
  # ...

  def content
    Puppet_X::Binford2k::NodeEncrypt::Value.new(File.read(resource[:path]))
  end

  def content=(value)
    File.write(resource[:path], resource[:content].decrypted_value)
  end
end</code></pre>


</div>
<div class="notes-section notes">

<ul>
<li>That was a lot of providers, so .... I only ever got around to writing one</li>
<li>But this is how it works</li>
<li>It was a provider for an encrypted file</li>
<li>the only thing it could manage was file content</li>
<li>decrypted using the agent's certificates</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="defined_type" id="slides_defined_type" class="slide" data-transition="none">
<div class="content " ref="slides/defined_type">
<h1>Packaged up in a defined type</h1>

<pre class="highlight"><code class="language-puppet">define node_encrypt::file (
  $ensure                  = 'file',
  $path                    = $title,
  $backup                  = undef,
  $checksum                = undef,
  $content                 = undef, # managed by the custom provider
  $force                   = undef,
  #...
) {
  file { $title:
    ensure                =&gt; $ensure,
    path                  =&gt; $path,
    backup                =&gt; $backup,
    checksum              =&gt; $checksum,
    force                 =&gt; $force,
    #...
  }

  node_encrypted_file { $path:
    content =&gt; $content,
    before  =&gt; File[$title], # let the File resource do all the work
  }
  Node_encrypt::File&lt;| title == $title |&gt; {content =&gt; '&lt;&lt;encrypted&gt;&gt;'}
}</code></pre>


</div>
<div class="notes-section notes">

<ul>
<li>As you can see, while it worked fine, it was tedious as hell.</li>
<li>I wrapped up a file resource in this defined type instead of doing it in the
Ruby provider so that I didn't have to make two providers inheriting from each
of posix and windows.</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="example_node_encrypt" id="slides_example_node_encrypt" class="slide" data-transition="none">
<div class="content " ref="slides/example_node_encrypt">
<h1>Example Secret with Stub File</h1>

<h2>Wrapper type encrypts <em>content</em>
</h2>

<pre class="highlight"><code class="language-puppet">node_encrypt::file { '/etc/payroll/credentials2.conf':
  ensure  =&gt; file,
  owner   =&gt; 'root',
  group   =&gt; 'root',
  mode    =&gt; '0600',
  content =&gt; 'some fake secret for cfgmgmtcamp',
}</code></pre>



<pre class="highlight"><code class="language-shell execute code_wrap">bolt command run "cat /etc/payroll/credentials2.conf"  --node agent</code></pre>



<pre class="highlight"><code class="language-shell execute code_wrap">bolt command run "jq '.resources[] | select(.type == \"File\" and .title == \"/etc/payroll/credentials2.conf\").parameters' /opt/puppetlabs/puppet/cache/client_data/catalog/agent.json" --node agent</code></pre>



<pre class="highlight"><code class="language-shell execute code_wrap">bolt command run "jq '.resources[] | select(.type == \"Node_encrypted_file\" and .title == \"/etc/payroll/credentials2.conf\").parameters' /opt/puppetlabs/puppet/cache/client_data/catalog/agent.json" --node agent</code></pre>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="agent_side_functions" id="slides_agent_side_functions" class="slide" data-transition="none">
<div class="content " ref="slides/agent_side_functions">
<h1>What about every other resource type?</h1>

<p><img src="./file//_images/think_about.jpg" alt="think about"></p>

<p class="callout warning">This would be so much more useful if I could just run a
function on the agent during enforcement...</p>


</div>
<div class="notes-section notes">

<ul>
<li>Sure enough, almost immediately someone wanted to encrypt a user password on Windows</li>
<li>And then someone else wanted to use concat with a secret</li>
<li>And I couldn't support either, without writing custom providers for each. </li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="deferred_type" id="slides_deferred_type" class="slide" data-transition="none">
<div class="content " ref="slides/deferred_type">
<h1>Puppet 6 introduces <em>Deferred Functions</em>
</h1>

<h2>Evaluated by agent during enforcement</h2>

<p>Building a template on the agent:</p>

<pre class="highlight"><code class="language-puppet">$variables = {
  'password' =&gt; Deferred('vault_lookup::lookup',
                  ["secret/test", 'https://vault.docker:8200']),
}

# compile the template source into the catalog
file { '/etc/secrets.conf':
  ensure  =&gt; file,
  content =&gt; Deferred('inline_epp',
               [file('mymodule/secrets.conf.epp'), $variables]),
}</code></pre>

<p class="callout info">Any Puppet 4.x function that returns a value can be deferred except
for those using scope variables or interacting with the catalog.</p>


</div>
<div class="notes-section notes">

<ul>
<li>Secret value is resolved on agent</li>
<li>Template is rendered on agent</li>
<li>Declare an instance of the <code>Deferred</code> data type</li>
<li>Give it the name of the function you want to call and an array of arguments</li>
<li>Use <strong><code>inline_template()</code></strong> and <strong><code>file()</code></strong> to include template source in catalog</li>
<li>You can defer most Puppet 4.x functions</li>
<li>Note: only <code>.epp</code> style templates can be deferred due to how ERB uses scope.</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="two_important_points" id="slides_two_important_points" class="slide center" data-transition="none">
<div class="content center" ref="slides/two_important_points">
<h1>But hold up a moment!</h1>

<h2>Deferred functions are designed very specifically</h2>

<p class="callout stop">There are guardrails in place to ensure that deferred functions
continue to be part of a maintainable and declarative codebase.</p>

<p>Some implementation details that will matter:</p>

<ol>
<li>
<code>Deferred</code> is a data type, so it returns an <code>Object</code>.</li>
<li>Deferred functions must <em>resolve to a value</em>.</li>
</ol>

<h3>We will revisit these points <i class="fa fa-thumbtack"></i>
</h3>


</div>
<div class="notes-section notes">

<ul>
<li>This sounds like I'm talking about breakfast cereals here</li>
<li>But these are important points for keeping your code manageable long term.</li>
<li>I spend a lot of time in Slack rescuing people from bad decisions.</li>
<li>Selfishly, I don't want you to be one of them.</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="puppet4_functions" id="slides_puppet4_functions1" class="slide" data-transition="none">
<div class="content " ref="slides/puppet4_functions:1">
<h1>Porting the module</h1>

<h2>From custom providers to deferred functions</h2>

<p class="callout meh">After all that buildup, I'm afraid this might be a little anticlimactic.</p>

<ul>
<li>Do you remember what's needed to defer a function?</li>
</ul>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="puppet4_functions" id="slides_puppet4_functions2" class="slide" data-transition="none">
<div class="content " ref="slides/puppet4_functions:2">
<h1>Porting the module</h1>

<h2>From custom providers to deferred functions</h2>

<p class="callout grin">After all that buildup, I'm afraid this might be a little anticlimactic.</p>

<ul>
<li>Do you remember what's needed to defer a function?</li>
<li>Just expose the decrypt half as a Puppet 4.x function:</li>
</ul>



<pre class="highlight"><code class="language-ruby">Puppet::Functions.create_function(:node_decrypt) do
  dispatch :decrypt do
    param 'String', :content
  end

  def decrypt(content)
    Puppet::Pops::Types::PSensitiveType::Sensitive.new(
      Puppet_X::Binford2k::NodeEncrypt.decrypt(content)
    )
  end
end</code></pre>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="example_node_deferred" id="slides_example_node_deferred" class="slide" data-transition="none">
<div class="content " ref="slides/example_node_deferred">
<h1>Example Encrypted Secret</h1>

<h2>Deferring the function</h2>

<pre class="highlight"><code class="language-puppet">file { '/etc/payroll/credentials3.conf':
  ensure  =&gt; file,
  owner   =&gt; 'root',
  group   =&gt; 'root',
  mode    =&gt; '0600',
  content =&gt; Deferred("node_decrypt",
                [node_encrypt('some fake secret for cfgmgmtcamp')]
             ),
}</code></pre>



<pre class="highlight"><code class="language-shell execute code_wrap">bolt command run "cat /etc/payroll/credentials3.conf"  --node agent</code></pre>



<pre class="highlight"><code class="language-shell execute code_wrap">bolt command run "jq '.resources[] | select(.type == \"File\" and .title == \"/etc/payroll/credentials3.conf\").parameters' /opt/puppetlabs/puppet/cache/client_data/catalog/agent.json" --node agent</code></pre>


</div>
<div class="notes-section notes">

<ul>
<li>There you have it.</li>
<li>All you need to defer a function to agent enforcement time is a Puppet 4.x
function that doesn't do any funny stuff.</li>
<li>It's even relatively straightforward to use.</li>
<li>Use <code>node_encrypt</code> to encrypt on the master, then defer <code>node_decrypt</code> to the agent</li>
<li>.....but that's a lot of typing, yeah?</li>
<li>We can do better</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="secret_wrapper_function" id="slides_secret_wrapper_function" class="slide center" data-transition="none">
<div class="content center" ref="slides/secret_wrapper_function">
<h1>
<em>Deferred</em> is a Data Type</h1>

<h2>A <strong><em>value expression</em></strong>
</h2>

<ul>
<li>Returns a callable object</li>
<li>Wraps a function call and its arguments</li>
<li>Assign to variable like any other value expression</li>
<li>... or return it from a function:</li>
</ul>



<pre class="highlight"><code class="language-puppet">function node_encrypt::secret(String $data) &gt;&gt; Deferred {
  Deferred("node_decrypt", [node_encrypt($data)])
}  </code></pre>


</div>
<div class="notes-section notes">

<ul>
<li>Remember how I said that <em>Deferred</em> is a data type?</li>
<li>This is why that's important.</li>
<li>The thing it returns is just an object that you can do things to like any other object.</li>
<li>In our very first example, with the agent side template, we assigned it to a variable.</li>
<li>But we can also return it from a function.</li>
<li>So this is a Puppet language function</li>
<li>Which means that I can basically just cut &amp; paste the code from the last slide in</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="example_secret" id="slides_example_secret" class="slide" data-transition="none">
<div class="content " ref="slides/example_secret">
<h1>User friendly function</h1>

<h2>Deferred secret wrapped by a function call</h2>

<p>Just tag the string:</p>

<pre class="highlight"><code class="language-puppet">file { '/etc/payroll/credentials4.conf':
  ensure  =&gt; file,
  owner   =&gt; 'root',
  group   =&gt; 'root',
  mode    =&gt; '0600',
  content =&gt; 'some fake secret for cfgmgmtcamp'.node_encrypt::secret,
}</code></pre>



<pre class="highlight"><code class="language-shell execute code_wrap">bolt command run "cat /etc/payroll/credentials4.conf"  --node agent</code></pre>



<pre class="highlight"><code class="language-shell execute code_wrap">bolt command run "jq '.resources[] | select(.type == \"File\" and .title == \"/etc/payroll/credentials4.conf\").parameters' /opt/puppetlabs/puppet/cache/client_data/catalog/agent.json" --node agent</code></pre>


</div>
<div class="notes-section notes">

<ul>
<li>Yes, that's it.</li>
<li>It only took a few minutes to read the docs and do the port.</li>
<li>But now we can tag any string in our codebase and it's cast immediately to an
encrypted blob of ciphertext that's automatically decrypted on the agent at runtime.</li>
<li>I think that's pretty rad and it was shockingly easy to do.</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="suitability" id="slides_suitability" class="slide" data-transition="none">
<div class="content " ref="slides/suitability">
<h1>Deferring functions is easy</h1>

<h2>But let's talk about when you <em>should</em> do it</h2>

<p><img src="./file//_images/preoccupied.jpg" alt="You were so preoccupied..."></p>


</div>
<div class="notes-section notes">

<ul>
<li>Remember that I said this was going to be a lot about guardrails</li>
<li>And that we weren't going to be talking about how to use Puppet as
a fancy shell script engine</li>
<li>This is when we come back to the other point I mentioned earlier.</li>
<li>The only functions it makes sense to defer are those which return a value.</li>
<li>This framework does not allow you to defer logic</li>
<li>You cannot make decisions based on an agent side function</li>
<li>All it allows you to do is resolve a value as the catalog is enforced.</li>
<li>That's it; <strong>resolve a value</strong>.</li>
<li>And there's reason for this.</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="represent_state" id="slides_represent_state" class="slide" data-transition="none">
<div class="content " ref="slides/represent_state">
<h1>Catalogs represent state</h1>

<h2>Describe all configuration you care about</h2>

<ul>
<li>Determinate</li>
<li>Repeatable</li>
<li>Disposable</li>
</ul>

<p><img src="./file//_images/toss_test.gif" alt="toss test"></p>

<p class="callout info">If you cannot dispose of any given server and rebuild it trivially,
then your configuration is insufficient.</p>


</div>
<div class="notes-section notes">

<ul>
<li>I probably don't need to say this in 2019, but your catalog should describe
everything that matters about this server.</li>
<li>The hardware--or virtual hardware, container, etc--it runs on shouldn't matter</li>
<li>The server is just the executable form of that configuration model</li>
<li>Which means that your model should be simple and descriptive; not a fragile
shell script.</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="known_unknown" id="slides_known_unknown" class="slide" data-transition="none">
<div class="content " ref="slides/known_unknown">
<h1>Known Unknowns</h1>

<h2>aka, resolving values at runtime</h2>

<ul>
<li>We already do this all the time!</li>
<li>Items where the specific value is less important than what it <strong><em>is</em></strong>.

<ul>
<li>The latest version of PostgreSQL</li>
<li>Whatever address <code>mongo.example.com</code> resolves to</li>
<li>The <code>master</code> branch of the git repo</li>
<li>Admin user accounts from LDAP</li>
<li>Admin password from Vault</li>
</ul>
</li>
<li>Things where a placeholder that resolves at runtime is an acceptable risk.</li>
</ul>

<p class="callout warning">To be sure, these often do cause problems themselves, but that's
outweighed by the development velocity they enable and the internal consistency
they can provide (when they're not broken),</p>


</div>
<div class="notes-section notes">

<ul>
<li>But the computing world has a long history of using the known unknowns--like variables.</li>
<li>Facts are resolved early in the compilation, so we can just use their values.</li>
<li>We only put late bound variables in the catalog when being resolved at runtime is preferable.</li>
<li>I like to think of these late-bound variables as <strong><em>labels</em></strong>, because they're just a named placeholder for data</li>
<li>And importantly, the name describes <strong><em>what they are</em></strong>, which is often more important than what their value is</li>
<li>for example, that <code>mongodb.example.com</code> address is actually more specific than if we put the IP address

<ul>
<li>because when we update DNS, all the hosts talking to it just use that new address.</li>
<li>so the domain name has specific meaning as <em>"whatever address this currently resolves to"</em> instead
of just an IP address that was correct at some point in time.</li>
</ul>
</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="use_cases" id="slides_use_cases" class="slide" data-transition="none">
<div class="content " ref="slides/use_cases">
<h1>Deferred function use cases</h1>

<h2>Only when you need a placeholder for a value</h2>

<p class="callout warning">Agent side functions should not make config changes, or have
side effects, or attempt to be conditionals. They should <strong><em>only</em></strong> resolve a
value at runtime that should only be known by the agent.</p>

<ul>
<li>Most system info values should continue to be facts

<ul>
<li>Allows info to be surfaced in PuppetDB too, for example</li>
</ul>
</li>
<li>Use deferred functions when:

<ul>
<li>Secret values that should not be known by the master</li>
<li>Want values to update on each run even when using cached catalogs</li>
<li>Agent has access to data master doesn't and you can't mirror</li>
</ul>
</li>
<li>...<em>and maybe a few edge cases</em>
</li>
</ul>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="label_examples" id="slides_label_examples" class="slide" data-transition="none">
<div class="content " ref="slides/label_examples">
<h1>Example Use Cases</h1>

<h2>Things that make sense to use Deferred functions for</h2>

<ul>
<li>Secret management:

<ul>
<li>Retrieving secrets from a secret server</li>
<li>Decrypting values agent side (<a href="https://github.com/binford2k/binford2k-node_encrypt" target="_blank"><code>binford2k/node_encrypt</code></a>)</li>
</ul>
</li>
<li>Service discovery:

<ul>
<li>Consul (<a href="https://github.com/ploperations/ploperations-consul_data" target="_blank"><code>ploperations/consul_data</code></a>)</li>
<li>Zookeeper</li>
<li>etcd</li>
</ul>
</li>
<li>Reduce load on the master by offloading a heavy computation:

<ul>
<li>Generate self-signed  SSL certificates for test webservers</li>
</ul>
</li>
<li>Make an API call:

<ul>
<li>Register in some kind of directory service</li>
<li>Trigger completion of a step in your provisioner</li>
</ul>
</li>
</ul>


</div>
<div class="notes-section notes">

<ul>
<li>See, I'm already violating the rules I jsut gave you.

<ul>
<li>Because the act of making an API call is depending on a side effect.</li>
<li>That's important, because intent, clarity, and maintainability take precedence.</li>
</ul>
</li>
<li>node_encrypt is the module I just ported for you</li>
<li>consul_data is a newly developed module by our internal ops SRE team for
declarative agent side service discovery.</li>
<li>You're invited to try them out, offer feedback, submit PRs, etc.</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="immutable_configuration" id="slides_immutable_configuration" class="slide" data-transition="none">
<div class="content " ref="slides/immutable_configuration">
<h1>Immutable Configuration</h1>

<h2>For all practical purposes</h2>

<ul>
<li>Puppet converges to a defined state every 30 minutes by default</li>
<li>Long term, the state you define is the state your node will be in</li>
<li>It's up to you to make that state definition as descriptive as possible

<ul>
<li>Use placeholders for data when that makes sense</li>
<li>Because that label describes intent more than the value it resolves to</li>
</ul>
</li>
<li>Your model is more repeatable when you depend on fewer external artifacts</li>
</ul>

<p class="callout info">Ideally you want each node itself to be utterly irrelevant because
you can trivially build a new one configured exactly as needed.</p>


</div>
<div class="notes-section notes">

<ul>
<li>And this gets us to a more-or-less immutable configuration.</li>
<li>Puppet will converge you to defined state each time it runs

<ul>
<li>So long-term, your configuration is stable at that defined state.</li>
</ul>
</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="summary" id="slides_summary" class="slide center" data-transition="none">
<div class="content center" ref="slides/summary">
<h1>Summary</h1>

<p><img src="./file//_images/puppet6.png" class=" float_right" alt=""></p>

<ul>
<li>Agent side functions are totally a thing now.</li>
<li>Any Puppet 4.x function can be deferred

<ul>
<li>Resolve a value</li>
<li>Has no side effects</li>
</ul>
</li>
<li>Use deferred functions as placeholders for late-resolved values</li>
<li>Should focus on providing intent </li>
</ul>
</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="more_info" id="slides_more_info" class="slide sidebar" data-transition="none">
<div class="content sidebar" ref="slides/more_info">
<h1>More Infos</h1>

<h2>Docs are in the <em>Custom Functions</em> section</h2>

<p><img src="./file//_images/docs.png" class=" float_left" alt=""></p>

<p>Direct links:</p>

<ul>
<li>
<a href="https://puppet.com/docs/puppet/6.2/integrating_secrets_and_retrieving_agent-side_data.html" target="_blank">Using Deferred functions</a>

<ul>
<li>Integrations with secret stores</li>
<li>Using a Deferred function</li>
</ul>
</li>
<li>
<a href="https://puppet.com/docs/puppet/6.2/write_a_puppet_function_to_store_secrets.html" target="_blank">Writing a Deferred function</a>

<ul>
<li>Creating a Puppet 4.x function in its own module</li>
<li>Notes on using deferred functions</li>
</ul>
</li>
</ul>


</div>
<div class="notes-section notes">

<ul>
<li>It's under this section because we see this as the main use case for this.</li>
<li>I'm sure we'll start to see more use cases--I came up with a few here--and
we'll expand the docs as that happens.</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="contributor_summit" id="slides_contributor_summit" style="background-image: url('file/_images/budapest.jpg');" class="slide center invert nofooter" data-transition="none">
<div class="content center invert nofooter" ref="slides/contributor_summit">
<h1>Contributor Summit: 2019</h1>

<h2>Budapest in June!</h2>

<p class="callout thumbsup fixed">And this is my attempt at a markety slide! Do you like it?</p>


</div>
<div class="notes-section notes">

<ul>
<li>Come see me in Budapest and learn more about deferred functions and other cool new tech!</li>
<li>We'll be running another Project Month building up to it</li>
<li>I'd love to see some projects impementing deferred functions

<ul>
<li>Or Bolt backed projects</li>
<li>Or even something using Lyra</li>
</ul>
</li>
<li>Keep an eye out, we'll be announcing details soon.</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
<div data-section="slides" data-title="end" id="slides_end" class="slide center nofooter" data-transition="none">
<div class="content center nofooter" ref="slides/end">
<h1><em>fin</em></h1>

<h2>Deferred functions in Puppet 6</h2>

<p><img src="./file//_images/little.jpg" class=" float_right" alt=""></p>

<ul>
<li>Ben Ford</li>
<li>Developer Advocate @ Puppet</li>
<li>I build things and talk to people</li>
<li>@binford2k:
<a href="https://www.twitter.com/binford2k" target="_blank"> [fab-twitter] </a>
<a href="https://www.github.com/binford2k" target="_blank"> [fab-github] </a>
<a href="https://puppetcommunity.slack.com/team/U11HA7VJ7" target="_blank"> [fab-slack] </a>
</li>
</ul>


</div>
<div class="notes-section notes">

<ul>
<li>And that's it.</li>
<li>Again, I'm Ben Ford--or binford2k on the internets--and I work at Puppet.</li>
<li>I'm our Developer Advocate, which means that I get to build cool shit and talk to people.</li>
<li>And that makes me happy, which is all we can ever ask for, right?</li>
<li>Thanks for listening.</li>
</ul>

</div>
<canvas class="annotations"></canvas>
</div>
</div>
<div id="buttonNav">
  <div id="buttonPrev"><i class="fa fa-chevron-left fa-lg"></i> Previous</div><div id="buttonNext">Next <i class="fa fa-chevron-right fa-lg"></i></div>
</div>
<div id="pauseScreen">
  PAUSED
</div>

  <script defer type="text/javascript">
    // We want the audience members to see automatic tours. We can assume that they won't be
    // using many server domains like the presenter might.
    var autoTour = true;

    $( document ).ready(function() {
      if(presenter && !window.opener) {
        alert('This is an audience view designed for interactivity. If you are placing this window on a projector, you should use the Display View instead.');
      }

      tours['showoff:activity'] = [
        {
          element: ".currentSlide .activityToggle",
          intro: I18n.t('tour.activity.complete')
        }
      ];

      tours['showoff:form'] = [
        {
          element: ".currentSlide input.save",
          intro: I18n.t('tour.form.save')
        }
      ];

      tours['showoff:menu'] = [
        {
          element: "#hamburger",
          intro: I18n.t('tour.menu.start')
        },
        {
          element: "#navToggle",
          intro: I18n.t('tour.menu.navigation')
        },
        {
          element: "#fileDownloads",
          intro: I18n.t('tour.menu.download')
        },
        {
          element: "#paceFaster",
          intro: I18n.t('tour.menu.pace')
        },
        {
          element: "#questionToggle",
          intro: I18n.t('tour.menu.questions')
        },
        {
          element: "#feedbackToggle",
          intro: I18n.t('tour.menu.feedback')
        }
      ].filter(function(item) { return (document.querySelector(item['element'])) });
      // display tips for only the enabled features
    });
  </script>

</body>
</html>
